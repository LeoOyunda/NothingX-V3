-- LocalScript (place in StarterPlayerScripts)
-- FULL UI + client logic for Free Reward (creates UI at runtime)
-- Configurable values below

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Player = Players.LocalPlayer
local playerGui = Player:WaitForChild("PlayerGui")

local CONFIG = {
    AutoOpenOnJoin = true,            -- oyun açınca menu otomatik açılsın mı
    ForceFullMenu = true,             -- menüyü büyük/ortalanmış yap
    FullSize = UDim2.new(0.92,0,0.84,0),
    FullPos = UDim2.new(0.04,0,0.08,0),
    WatchAdSeconds = 5,               -- "reklam izleme" simülasyon süresi
    RewardAmount = 100,               -- sunucudan istenecek ödül miktarı (sunucu da bu değeri kullanacak)
    RemoteEventName = "ClaimFreeReward" -- ReplicatedStorage içindeki RemoteEvent adı
}

-- Helper: create GUI elements with defaults
local function Create(class, props)
    local obj = Instance.new(class)
    if props then
        for k,v in pairs(props) do
            if k ~= "Parent" then obj[k] = v end
        end
        if props.Parent then obj.Parent = props.Parent end
    end
    return obj
end

-- Ensure we have a ScreenGui
local screenGui = Create("ScreenGui", {Name = "AutoFreeRewardGui", ResetOnSpawn = false, Parent = playerGui})

-- Left vertical container with FREE button
local leftFrame = Create("Frame", {
    Name = "LeftBar",
    Parent = screenGui,
    Size = UDim2.new(0, 80, 0.45, 0),
    Position = UDim2.new(0, 8, 0.18, 0),
    BackgroundTransparency = 1,
})
local list = Create("UIListLayout", {Parent = leftFrame, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0,8)})
list.HorizontalAlignment = Enum.HorizontalAlignment.Center
list.VerticalAlignment = Enum.VerticalAlignment.Top

local function makeSideButton(text, order)
    local btn = Create("TextButton", {
        Name = text.."Btn",
        Parent = leftFrame,
        Size = UDim2.new(1,0,0,56),
        BackgroundColor3 = Color3.fromRGB(32, 32, 32),
        TextColor3 = Color3.fromRGB(255,255,255),
        Text = text,
        Font = Enum.Font.SourceSansBold,
        TextSize = 20,
        AutoButtonColor = true,
    })
    btn.LayoutOrder = order or 1
    return btn
end

local freeButton = makeSideButton("FREE", 1)
local extraBtn1 = makeSideButton("Menu", 2) -- placeholder buttons
local extraBtn2 = makeSideButton("Props", 3)

-- Main reward menu (hidden by default)
local menuFrame = Create("Frame", {
    Name = "FreeRewardMenu",
    Parent = screenGui,
    Size = UDim2.new(0.88, 0, 0.72, 0),
    Position = UDim2.new(0.06, 0, 0.14, 0),
    BackgroundColor3 = Color3.fromRGB(230,230,230),
    Visible = false,
    AnchorPoint = Vector2.new(0,0),
})
menuFrame.BorderSizePixel = 0
menuFrame.ZIndex = 50

-- Header
local header = Create("Frame", {
    Parent = menuFrame,
    Size = UDim2.new(1,0,0,64),
    BackgroundTransparency = 0.06,
    BackgroundColor3 = Color3.fromRGB(20,20,20),
})
local headerLabel = Create("TextLabel", {
    Parent = header,
    Size = UDim2.new(0.95,0,1,0),
    Position = UDim2.new(0.025,0,0,0),
    BackgroundTransparency = 1,
    Text = "Watch Ad -> Free Reward!",
    TextColor3 = Color3.fromRGB(255,255,255),
    Font = Enum.Font.SourceSansBold,
    TextSize = 28,
    TextXAlignment = Enum.TextXAlignment.Left,
})

local closeBtn = Create("TextButton", {
    Parent = header,
    Size = UDim2.new(0,48,0,48),
    Position = UDim2.new(1,-56,0,8),
    BackgroundColor3 = Color3.fromRGB(200,50,50),
    Text = "X",
    TextColor3 = Color3.fromRGB(255,255,255),
    Font = Enum.Font.SourceSansBold,
    TextSize = 24,
})
closeBtn.ZIndex = 60

-- Content area with grid of sample items
local content = Create("Frame", {
    Parent = menuFrame,
    Size = UDim2.new(1, -24, 1, -120),
    Position = UDim2.new(0,12,0,76),
    BackgroundTransparency = 1,
})
local scrolling = Create("ScrollingFrame", {
    Parent = content,
    Size = UDim2.new(1,0,1,0),
    CanvasSize = UDim2.new(0,0,0,0),
    BackgroundTransparency = 1,
    ScrollBarThickness = 6,
})
local grid = Create("UIGridLayout", {Parent = scrolling})
grid.CellSize = UDim2.new(0,120,0,120)
grid.CellPadding = UDim2.new(0,12,0,12)
grid.FillDirection = Enum.FillDirection.Horizontal

-- Sample items (placeholders)
for i=1,16 do
    local it = Create("Frame", {Parent = scrolling, Size = UDim2.new(0,120,0,120), BackgroundColor3 = Color3.fromRGB(245,245,245)})
    local img = Create("ImageLabel", {Parent = it, Size = UDim2.new(1,0,0.75,0), BackgroundTransparency = 1, Image = ""})
    local lbl = Create("TextLabel", {Parent = it, Size = UDim2.new(1,0,0.25,0), Position = UDim2.new(0,0,0.75,0), BackgroundTransparency = 1, Text = "Item "..i, TextColor3 = Color3.fromRGB(30,30,30)})
end

-- Footer with Watch Ad button and status
local footer = Create("Frame", {
    Parent = menuFrame,
    Size = UDim2.new(1,0,0,56),
    Position = UDim2.new(0,0,1,-56),
    BackgroundTransparency = 0.05,
})
local watchBtn = Create("TextButton", {
    Parent = footer,
    Size = UDim2.new(0.5, -16, 1, -12),
    Position = UDim2.new(0.5,8,0,6),
    Text = "Watch Ad / Claim",
    BackgroundColor3 = Color3.fromRGB(50,150,250),
    TextColor3 = Color3.fromRGB(255,255,255),
    Font = Enum.Font.SourceSansBold,
    TextSize = 20,
})
watchBtn.AnchorPoint = Vector2.new(0,0)

local statusLabel = Create("TextLabel", {
    Parent = footer,
    Size = UDim2.new(0.48, -16, 1, -12),
    Position = UDim2.new(0, 8, 0, 6),
    BackgroundTransparency = 1,
    Text = "Ready",
    TextColor3 = Color3.fromRGB(30,30,30),
    Font = Enum.Font.SourceSans,
    TextSize = 18,
    TextXAlignment = Enum.TextXAlignment.Left,
})

-- Utility: adjust full size if requested
local function MakeMenuFull()
    if CONFIG.ForceFullMenu then
        menuFrame.Size = CONFIG.FullSize
        menuFrame.Position = CONFIG.FullPos
        menuFrame.AnchorPoint = Vector2.new(0,0)
    end
end

-- Replicated event hookup
local remoteEvent = ReplicatedStorage:FindFirstChild(CONFIG.RemoteEventName)

-- Listen for server response (optional, server will send feedback)
if remoteEvent then
    remoteEvent.OnClientEvent:Connect(function(success, message, newTotal)
        if success then
            statusLabel.Text = message or "Reward claimed!"
            -- Optional: show new total if server returned
            if newTotal then
                statusLabel.Text = statusLabel.Text.." Total: "..tostring(newTotal)
            end
        else
            statusLabel.Text = message or "Claim failed."
        end
        watchBtn.Active = true
        watchBtn.Text = "Watch Ad / Claim"
    end)
end

-- Watch ad simulation + request reward
local function WatchAndClaim()
    watchBtn.Active = false
    watchBtn.Text = "Watching..."
    statusLabel.Text = "Watching ad..."
    for i = CONFIG.WatchAdSeconds, 1, -1 do
        watchBtn.Text = "Watching... "..tostring(i)
        wait(1)
    end
    watchBtn.Text = "Claiming..."
    statusLabel.Text = "Requesting reward..."
    -- If remote event exists, fire server to grant reward (server handles cooldown)
    if not remoteEvent then
        -- Local fallback: modify leaderstats (best-effort, insecure)
        statusLabel.Text = "No server event found. Giving local reward (debug only)."
        local leader = Player:FindFirstChild("leaderstats")
        if not leader then
            leader = Instance.new("Folder")
            leader.Name = "leaderstats"
            leader.Parent = Player
        end
        local coins = leader:FindFirstChild("Coins")
        if not coins then
            coins = Instance.new("IntValue")
            coins.Name = "Coins"
            coins.Value = 0
            coins.Parent = leader
        end
        coins.Value = coins.Value + CONFIG.RewardAmount
        statusLabel.Text = "Reward given locally: +"..CONFIG.RewardAmount
        watchBtn.Active = true
        watchBtn.Text = "Watch Ad / Claim"
        return
    end
    -- FireServer with requested amount (server will validate/cooldown)
    remoteEvent:FireServer(CONFIG.RewardAmount)
end

-- Connections
freeButton.MouseButton1Click:Connect(function()
    menuFrame.Visible = true
    MakeMenuFull()
end)
closeBtn.MouseButton1Click:Connect(function()
    menuFrame.Visible = false
end)
watchBtn.MouseButton1Click:Connect(function()
    -- prevent double taps
    if not watchBtn.Active then return end
    WatchAndClaim()
end)

-- Auto open on join if requested
if CONFIG.AutoOpenOnJoin then
    -- tiny delay to let PlayerGui fully load
    task.delay(0.25, function()
        menuFrame.Visible = true
        MakeMenuFull()
    end)
end
